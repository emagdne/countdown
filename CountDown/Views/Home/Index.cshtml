@model IPagedList<CountDown.Models.Domain.ToDoItem>

@{
    ViewBag.Title = "Home";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section scripts
{
    <script type="text/javascript">
        // Global variables
        var completeUrl = '@Url.RouteUrl("CompleteToDo")';
        var editUrl = '@Url.RouteUrl("EditToDo")';
    </script>
    <script src="~/Scripts/Home/index.js"></script>
}

<div class="container">
    <div class="row">
        <div class="col-md-3">
            <div class="top-buffer"></div>
            <div id="index-options-pane">
                <div id="index-options-pane-contents">
                    <div>@Html.ActionLink("Create To-Do Item", "Create", "ToDo", null, new {@id = "index-create-link"})</div>
                    <div id="index-filter-options">
                        <strong>Show</strong>
                        <form action="@Url.Action("Index")" role="form">
                            <div class="form-group">
                                <div class="checkbox">
                                    <label>
                                        <input id="index-owned-by-me-checkbox" type="checkbox" name="ownedByMe" value="true"
                                            @if (Request["ownedByMe"] == null || Request["ownedByMe"].Equals("true") || Request["ownedByMe"].Equals("true,false"))
                                            {
                                                @Html.Raw("checked=\"checked\"")
                                            } /><input type="hidden" value="false" name="ownedByMe" /> Owned by me
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label>
                                        <input id="index-owned-by-others-checkbox" type="checkbox" name="ownedByOthers" value="true"
                                            @if (Request["ownedByOthers"] == null || Request["ownedByOthers"].Equals("true") || Request["ownedByOthers"].Equals("true,false"))
                                            {
                                                @Html.Raw("checked=\"checked\"")
                                            }
                                            /><input type="hidden" value="false" name="ownedByOthers" /> Owned by others
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label>
                                        <input id="index-assigned-to-others-checkbox" type="checkbox" name="assignedToOthers" value="true"
                                            @if (Request["assignedToOthers"] != null && (Request["assignedToOthers"].Equals("true") || Request["assignedToOthers"].Equals("true,false")))
                                            {
                                                @Html.Raw("checked=\"checked\"")
                                            } /><input type="hidden" value="false" name="assignedToOthers" /> Assigned to others
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label>
                                        <input id="index-filter-completed-checkbox" type="checkbox" name="completed" value="true"
                                            @if (Request["completed"] != null && (Request["completed"].Equals("true") || Request["completed"].Equals("true,false")))
                                            {
                                                @Html.Raw("checked=\"checked\"")
                                            } /><input type="hidden" value="false" name="completed" /> Completed
                                    </label>
                                </div>
                            </div>
                            @if (Request["page"] != null)
                            {
                                <input type="hidden" value="@Request["page"]" name="page"/>
                            }
                            <input type="submit" class="btn-sm btn-primary text-right" value="Apply"/>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-9">
            <h3>To-Do Items</h3>
            @if (TempData["indexMessage"] != null)
            {
                <div id="index-message-wrapper">
                    <div id="index-message">@TempData["indexMessage"]</div>
                </div>
            }
            <hr/>
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Time Left</th>
                        <th>Owner</th>
                        <th>Assigned to</th>
                        <th>Completed</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr class="index-table-row">
                            <td class="index-id-cell hide">@item.Id</td>
                            <td>@item.Title</td>
                            <td class="index-timeleft-cell">@{
                                                                if (item.TimeLeft.HasValue)
                                                                {
                                                                    TimeSpan timeLeft = item.TimeLeft.Value;

                                                                    if (timeLeft.TotalSeconds > 0)
                                                                    {
                                                                        var days = (timeLeft.Days > 0) ? timeLeft.Days + " day(s), " : "";
                                                                        var hours = (timeLeft.Hours > 0) ? timeLeft.Hours + " hour(s), " : "";
                                                                        @Html.Raw(days + hours + timeLeft.Minutes + " minute(s).")
                                                                    }
                                                                    else
                                                                    {
                                                                        @Html.Raw("Passed due date.")
                                                                    }
                                                                }
                                                                else
                                                                {
                                                                    @Html.Raw("Time left unknown.")
                                                                }
                                                            }</td>
                            <td class="index-owner-cell">@Html.Raw((item.OwnerId == (Int64) ViewData["UserId"]) ? "Me" : item.Owner.FirstName)</td>
                            <td class="index-assignee-cell">@Html.Raw((item.AssigneeId == (Int64) ViewData["UserId"]) ? "Me" : item.Assignee.FirstName)</td>
                            <td class="index-completed-cell"><input type="checkbox" class="index-completed-checkbox"
                                                                 @if (item.Completed || item.AssigneeId != (Int64) ViewData["UserId"])
                                                                 {
                                                                     @Html.Raw(" disabled=\"disabled\"")
                                                                     if (item.Completed)
                                                                     {
                                                                         @Html.Raw(" checked=\"checked\"")
                                                                         ;
                                                                     }
                                                                 } /></td>
                        </tr>
                    }
                </tbody>
            </table>
            @if ((int) ViewData["TotalToDoItems"] > 10)
            {
                <div class="mvc-pager">
                    @Html.Pager(Model.PageSize, Model.PageNumber, Model.TotalItemCount).Options(
                        x => x.AddRouteValue("ownedByMe", Request["ownedByMe"] == null || Request["ownedByMe"].Equals("true") || Request["ownedByMe"].Equals("true,false") ? "true" : "false")
                            .AddRouteValue("ownedByOthers", Request["ownedByOthers"] == null || Request["ownedByOthers"].Equals("true") || Request["ownedByOthers"].Equals("true,false") ? "true" : "false")
                            .AddRouteValue("assignedToOthers", Request["assignedToOthers"] != null && (Request["assignedToOthers"].Equals("true") || Request["assignedToOthers"].Equals("true,false")) ? "true" : "false")
                            .AddRouteValue("completed", Request["completed"] != null && (Request["completed"].Equals("true") || Request["completed"].Equals("true,false")) ? "true" : "false")
                        )
                </div>
            }
        </div>
    </div>
</div>